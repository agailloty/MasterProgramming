<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Setting the environment | Scientific Computing with R &amp; Python</title>
  <meta name="description" content="2 Setting the environment | Scientific Computing with R &amp; Python" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Setting the environment | Scientific Computing with R &amp; Python" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Setting the environment | Scientific Computing with R &amp; Python" />
  
  
  

<meta name="author" content="Axel-Cleris Gailloty" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="multidimensional-arrays-with-numpy.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="setting-the-environment.html"><a href="setting-the-environment.html"><i class="fa fa-check"></i><b>2</b> Setting the environment</a><ul>
<li class="chapter" data-level="2.1" data-path="setting-the-environment.html"><a href="setting-the-environment.html#installing-a-python-interpreter-and-creating-environments"><i class="fa fa-check"></i><b>2.1</b> Installing a Python interpreter and creating environments</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multidimensional-arrays-with-numpy.html"><a href="multidimensional-arrays-with-numpy.html"><i class="fa fa-check"></i><b>3</b> Multidimensional Arrays with Numpy</a><ul>
<li class="chapter" data-level="3.1" data-path="multidimensional-arrays-with-numpy.html"><a href="multidimensional-arrays-with-numpy.html#goals"><i class="fa fa-check"></i><b>3.1</b> Goals</a></li>
<li class="chapter" data-level="3.2" data-path="multidimensional-arrays-with-numpy.html"><a href="multidimensional-arrays-with-numpy.html#numpy-arrays"><i class="fa fa-check"></i><b>3.2</b> Numpy arrays</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Scientific Computing with R &amp; Python</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="setting-the-environment" class="section level1">
<h1><span class="header-section-number">2</span> Setting the environment</h1>
<p>One of the most important thing to do before starting a project is to make sure everything is set up correctly so it will work later. This means installing the dependencies, creating environments that will be used throughout the project, easy to debug etc…</p>
<p>In this project we’ll be featuring the <code>reticulate</code> package designed to be the R interface to Python. This package helps us call Python code within an R session, it comes extremly useful to use third party Python libraries from within an R project. This is in my opinion a game changer in scientific computing and makes R very versatile.</p>
<p>To be able to use Python in R we need to install the <code>reticulate</code> package that we will configure for scientific use.</p>
<pre><code>install.packages(&quot;reticulate&quot;)</code></pre>
<p>We can now load this package into our environment to use its functions.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(reticulate)</a></code></pre></div>
<p>There are 85 useful functions inside this package to help us use Python from within R. Let’s print what is inside this package so you have a better idea of the things we can do with it.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">printElements &lt;-<span class="st"> </span><span class="cf">function</span>(package, <span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">pattern =</span> <span class="st">&quot;*&quot;</span>){</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">ls</span>(<span class="kw">paste0</span>(<span class="st">&quot;package:&quot;</span>, package)), <span class="dt">ncol =</span> ncol)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(mat)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  cols &lt;-<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(ncol)) {</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    cols &lt;-<span class="st"> </span><span class="kw">c</span>(cols, <span class="kw">paste</span>(<span class="kw">replicate</span>(i, pattern), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  <span class="kw">colnames</span>(df) &lt;-<span class="st"> </span>cols</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  <span class="kw">return</span>(df)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">printElements</span>(<span class="st">&quot;reticulate&quot;</span>, <span class="dv">4</span>))</a></code></pre></div>
<pre><code>Warning in matrix(ls(paste0(&quot;package:&quot;, package)), ncol = ncol): data length
[85] is not a sub-multiple or multiple of the number of rows [22]</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">*</th>
<th align="left">**</th>
<th align="left">***</th>
<th align="left">****</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">%as%</td>
<td align="left">np_array</td>
<td align="left">py_is_null_xptr</td>
<td align="left">PyClass</td>
</tr>
<tr class="even">
<td align="left">array_reshape</td>
<td align="left">py</td>
<td align="left">py_iterator</td>
<td align="left">r_to_py</td>
</tr>
<tr class="odd">
<td align="left">as_iterator</td>
<td align="left">py_available</td>
<td align="left">py_last_error</td>
<td align="left">register_class_filter</td>
</tr>
<tr class="even">
<td align="left">conda_binary</td>
<td align="left">py_call</td>
<td align="left">py_len</td>
<td align="left">register_help_topics</td>
</tr>
<tr class="odd">
<td align="left">conda_create</td>
<td align="left">py_capture_output</td>
<td align="left">py_list_attributes</td>
<td align="left">register_module_help_handler</td>
</tr>
<tr class="even">
<td align="left">conda_install</td>
<td align="left">py_clear_last_error</td>
<td align="left">py_load_object</td>
<td align="left">register_suppress_warnings_handler</td>
</tr>
<tr class="odd">
<td align="left">conda_list</td>
<td align="left">py_config</td>
<td align="left">py_main_thread_func</td>
<td align="left">repl_python</td>
</tr>
<tr class="even">
<td align="left">conda_python</td>
<td align="left">py_config_error_message</td>
<td align="left">py_module_available</td>
<td align="left">source_python</td>
</tr>
<tr class="odd">
<td align="left">conda_remove</td>
<td align="left">py_del_item</td>
<td align="left">py_numpy_available</td>
<td align="left">tuple</td>
</tr>
<tr class="even">
<td align="left">conda_version</td>
<td align="left">py_dict</td>
<td align="left">py_run_file</td>
<td align="left">use_condaenv</td>
</tr>
<tr class="odd">
<td align="left">configure_environment</td>
<td align="left">py_discover_config</td>
<td align="left">py_run_string</td>
<td align="left">use_miniconda</td>
</tr>
<tr class="even">
<td align="left">dict</td>
<td align="left">py_ellipsis</td>
<td align="left">py_save_object</td>
<td align="left">use_python</td>
</tr>
<tr class="odd">
<td align="left">eng_python</td>
<td align="left">py_eval</td>
<td align="left">py_set_attr</td>
<td align="left">use_virtualenv</td>
</tr>
<tr class="even">
<td align="left">import</td>
<td align="left">py_func</td>
<td align="left">py_set_item</td>
<td align="left">virtualenv_create</td>
</tr>
<tr class="odd">
<td align="left">import_builtins</td>
<td align="left">py_function_docs</td>
<td align="left">py_set_seed</td>
<td align="left">virtualenv_install</td>
</tr>
<tr class="even">
<td align="left">import_from_path</td>
<td align="left">py_function_wrapper</td>
<td align="left">py_str</td>
<td align="left">virtualenv_list</td>
</tr>
<tr class="odd">
<td align="left">import_main</td>
<td align="left">py_get_attr</td>
<td align="left">py_suppress_warnings</td>
<td align="left">virtualenv_python</td>
</tr>
<tr class="even">
<td align="left">install_miniconda</td>
<td align="left">py_get_item</td>
<td align="left">py_to_r</td>
<td align="left">virtualenv_remove</td>
</tr>
<tr class="odd">
<td align="left">iter_next</td>
<td align="left">py_has_attr</td>
<td align="left">py_to_r_wrapper</td>
<td align="left">virtualenv_root</td>
</tr>
<tr class="even">
<td align="left">iterate</td>
<td align="left">py_help</td>
<td align="left">py_unicode</td>
<td align="left">%as%</td>
</tr>
<tr class="odd">
<td align="left">miniconda_path</td>
<td align="left">py_id</td>
<td align="left">py_validate_xptr</td>
<td align="left">array_reshape</td>
</tr>
<tr class="even">
<td align="left">miniconda_update</td>
<td align="left">py_install</td>
<td align="left">py_versions_windows</td>
<td align="left">as_iterator</td>
</tr>
</tbody>
</table>
<p>We are not going to use all of the functions of this package because their use depends on the application.<br />
The functions we’ll be using are related to creating environments, installing Python libraries, sourcing Python files that contain classes and functions we will use inside our project.</p>
<div id="installing-a-python-interpreter-and-creating-environments" class="section level2">
<h2><span class="header-section-number">2.1</span> Installing a Python interpreter and creating environments</h2>
<p>In order to execute Python code we need to have a Python interpreter that will tell the computer what to do. You may already have a Python interpreter installed on your computer. Python comes installed with some Linux distributions such as Ubuntu or Debian.<br />
But what I advocate here is not to use your default system Python interpreter, but instead install a separate Python interpreter on which you will have more control and that helps you manage your dependencies easily. For that purpose we are going to set a Python virtual environment.</p>
<p>The two main virtual environments for Python are <code>virtualenv</code> and <code>conda</code>.<br />
For scientific computing the virtual environment that is recommanded is conda, so in this project I will featured conda but either you use virtualenv or conda the purpose is the same : isolate Python environments and manage the dependencies.<br />
There are functions in the reticulate package that helps installed either virtualenv or conda.<br />
To install conda we will use the <code>install_miniconda()</code> function. This will install a Python interpreter and some minimum packages. There is a full version of conda that comes with over 900 packages installed. For more information visit the <a href="https://www.anaconda.com/products/individual">Anaconda</a>.</p>
<pre><code># virtualenv_install() # for installing virtualenv
install_miniconda(path = &quot;/home/rstudio-user/miniconda&quot;, update = TRUE) # update = TRUE to update to the latest miniconda version</code></pre>
<p>By running the <code>install_miniconda()</code> function R installs on the computer a Python 3.6 interpreter with useful libraries such as numpy.
Since I am using RStudio Cloud I do not have the permissions to install miniconda at the system level, so the conda binary is installed in the rstudio-user folder.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">conda_binary</span>()</a></code></pre></div>
<pre><code>[1] &quot;/home/rstudio-user/miniconda/bin/conda&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="fu">ls</span> ~/miniconda</a></code></pre></div>
<pre><code>LICENSE.txt
bin
compiler_compat
conda-meta
condabin
envs
etc
include
lib
pkgs
share
shell
ssl
x86_64-conda_cos6-linux-gnu</code></pre>
<p>By default the <code>install_miniconda()</code> function creates an environment called r-reticulate that contain a Python 3.6 binary and other package dependencies. However this is not quite what we want. We would like to create our own environment for scientific computing where we want to use the latest Python 3.8 interpreter and some specific libraries that we will install.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># conda environments</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">conda_list</span>()</a></code></pre></div>
<pre><code>          name                                                    python
1    miniconda                   /home/rstudio-user/miniconda/bin/python
2 r-reticulate /home/rstudio-user/miniconda/envs/r-reticulate/bin/python
3     sci-comp     /home/rstudio-user/miniconda/envs/sci-comp/bin/python</code></pre>
<p>Let’s create our own environment that we will use throughout this project.</p>
<pre><code>py_config()</code></pre>
<pre><code>python:         /home/rstudio-user/miniconda/envs/r-reticulate/bin/python
libpython:      /home/rstudio-user/miniconda/envs/r-reticulate/lib/libpython3.6m.so
pythonhome:     /home/rstudio-user/miniconda/envs/r-reticulate:/home/rstudio-user/miniconda/envs/r-reticulate
version:        3.6.10 |Anaconda, Inc.| (default, May  8 2020, 02:54:21)  [GCC 7.3.0]
numpy:          /home/rstudio-user/miniconda/envs/r-reticulate/lib/python3.6/site-packages/numpy
numpy_version:  1.18.1

python versions found: 
 /home/rstudio-user/miniconda/envs/r-reticulate/bin/python
 /usr/bin/python3
 /usr/bin/python
 /home/rstudio-user/miniconda/bin/python</code></pre>
<pre><code>conda_create(&quot;sci-comp&quot;, packages = c(&quot;python=3.8&quot;, &quot;numpy&quot;, &quot;scipy&quot;))</code></pre>
<pre><code>Downloading and Extracting Packages
numpy-1.18.1         | 5 KB      | ########## | 100% 
numpy-base-1.18.1    | 4.2 MB    | ########## | 100% 
mkl_random-1.1.0     | 340 KB    | ########## | 100% 
six-1.14.0           | 27 KB     | ########## | 100% 
certifi-2020.4.5.1   | 156 KB    | ########## | 100% 
mkl_fft-1.0.15       | 159 KB    | ########## | 100% 
scipy-1.4.1          | 14.8 MB   | ########## | 100% 
setuptools-46.1.3    | 523 KB    | ########## | 100% 
python-3.8.2         | 49.2 MB   | ########## | 100% 
wheel-0.34.2         | 51 KB     | ########## | 100% 
pip-20.0.2           | 1.7 MB    | ########## | 100% 
mkl-service-2.3.0    | 62 KB     | ########## | 100% 
Preparing transaction: ...working... done
Verifying transaction: ...working... done
Executing transaction: ...working... done
#
# To activate this environment, use
#
#     $ conda activate sci-comp
#
# To deactivate an active environment, use
#
#     $ conda deactivate

[1] &quot;/home/rstudio-user/miniconda/envs/sci-comp/bin/python&quot;</code></pre>
<p>Then we will tell R to use that newly created conda environment.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">use_condaenv</span>(<span class="st">&quot;sci-comp&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># Try to use numpy</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">np &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;numpy&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">np<span class="op">$</span><span class="kw">arange</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code> [1]  0.0  0.5  1.0  1.5  2.0  2.5  3.0  3.5  4.0  4.5  5.0  5.5  6.0  6.5  7.0
[16]  7.5  8.0  8.5  9.0  9.5 10.0 10.5 11.0 11.5 12.0 12.5 13.0 13.5 14.0 14.5
[31] 15.0 15.5 16.0 16.5 17.0 17.5 18.0 18.5 19.0 19.5</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multidimensional-arrays-with-numpy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
